[pytest]
# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test directories
testpaths = tests

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Test execution options
addopts =
    --verbose
    --strict-markers
    --tb=short
    # GUI tests will use offscreen platform (configured in conftest.py)
    # Coverage disabled by default for faster runs
    # Use pytest -c pytest-coverage.ini for coverage
    # --cov=base
    # --cov=gui
    # --cov-report=html
    # --cov-report=term-missing
    # --cov-report=xml
    # --cov-branch
    # --cov-fail-under=50
    # Uncomment for parallel execution (requires pytest-xdist)
    # -n auto
    # --dist=loadfile

# Markers for test categorization
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    gui: marks tests that require GUI components
    unit: marks tests as unit tests
    requires_data: marks tests that require external data files
    benchmark: marks performance benchmark tests
    gpu: marks tests that require GPU resources
    mock_heavy: marks tests with extensive mocking
    critical: marks tests for critical functionality
    real_tensorflow: marks tests that require real TensorFlow (not mocked)
    mock_tensorflow: marks tests that should use mocked TensorFlow
    pytorch: marks tests that require PyTorch
    pytorch_integration: marks PyTorch integration tests
    pytorch_training: marks PyTorch training tests
    cross_framework: marks tests for cross-framework compatibility
    requires_tensorflow: marks tests that require TensorFlow for cross-framework validation

# Ignore deprecation warnings from dependencies
filterwarnings =
    ignore::DeprecationWarning:tensorflow.*
    ignore::DeprecationWarning:keras.*
    ignore::FutureWarning:tensorflow.*
    ignore::ResourceWarning
    # Suppress GUI warnings in test environment (expected when GUI unavailable)
    ignore:GUI not available, using core implementation:UserWarning:base.tissue_area.threshold

# Timeout for tests (in seconds)
# GUI tests and integration tests may need more time
# Integration tests with tile generation can take 3-5 minutes
timeout = 600
timeout_method = thread
# Note: Use @pytest.mark.timeout(seconds) to override for specific slow tests

# Qt/GUI test configuration
# Note: Project uses custom Qt fixture in conftest.py (not pytest-qt plugin)

# Parallel execution (if pytest-xdist is installed)
# Uncomment the line below to enable parallel execution
# Note: Some GUI tests may fail in parallel mode
# addopts = -n auto --dist=loadfile